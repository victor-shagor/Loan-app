<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta http-equiv="X-UA-Compatible" content="ie=edge">
 <title>View Loans</title>
 <link rel="stylesheet" href="materialize.min.css">
 <link href="icon.css" rel="stylesheet">
 <link rel="stylesheet" href="styles/dashboard.css">
</head>
<header>
  <nav class="nav-wraper">
   <div class="container">
    <a href="index.html" class="brand-logo"><img src="img/logo.png" alt=""></a>
    </a>    
    <ul class="right hide-on-med-and-down">
     <li><a href="#">Home</a></li>
     <li><a href="#">Logout</a></li>
     <li><a href="#" class="btn-floating white">
       <i class="material-icons">person</i>
     </a></li>
     <span class="user">Welcome Name</span>
    </ul>
   </div>
  </nav>
  <ul id="slide-out" class="sidenav">
        <li><div class="user-view">
            <div class="background">
            </div>
            <a href="#user"><img class="circle" src="img/messi.jpeg"></a>
            <a href="#name"><span class="white-text name">John Doe</span></a>
            <a href="#email"><span class="white-text email">jdandturk@gmail.com</span></a>
          </div></li>
    <li><a href="./apply.html">Apply for Loan</a></li>
    <li><a href="#">View loan applications</a></li>
  </ul>
  <a href="#" data-target="slide-out" class="sidenav-trigger">
      <i class="material-icons">menu</i>
  </a>
  <div class="container view">
  <table class="striped responsive-table">
    <thead>
      <tr>
          <th></th>
          <th>Amount</th>
          <th>Tenor</th>
          <th>interest</th>
          <th>monthlyPayment</th>
          <th>Action</th>
      </tr>
    </thead>

    <tbody class="table">
    </tbody>
  </table>
 </div>
<body>
  <script src="jquery-3.3.1.min.js"></script>
 <script src="materialize.min.js"></script>
<script>
  $(document).ready(function get(){
   let name = localStorage.lastname
   let email = localStorage.email
   let output ='';
   $('.sidenav').sidenav()
   $('.user').html(`Welcome ${name}`)
 $.ajax({
    type        : 'GET',
    url         : `http://localhost:4000/loan?status=pending`,
})
    .done(function(res) {
     console.log(res)
       if(!res.length){
        return console.log('There are no loans to view')
       }
  
  
 
  res.forEach((loan) =>{
  
   output += `
   <tr>
     <td><input type="submit" class="btn delete" data-id=${loan.id} id="delete"value="Delete"></td>
     <td>${loan.Amount}</td>       
     <td>${loan.tenor}</td>
     <td>${loan.interest}</td>
     <td>${loan.monthlyPayment}</td>
     <td><input type="submit" class="btn approve" data-id=${loan.id} id="approval"value="Approve"><input type="submit" class ="btn reject" data-id=${loan.id} id="reject"value="reject"></td>
     </tr>
    ` 
    
  
  })
  $('.table').html(output);
    })
  $('.view').on('click', function(event){
    let data;
    let id = event.target.dataset.id
    if(event.target.classList.contains('approve')){
      data = {status:"approved"}
    }
    else if(event.target.classList.contains('reject')){
      data = {status:"rejected"}
    }
    $.ajax({
    type        : 'PATCH',
    url         : `http://localhost:4000/loan/${id}`,
    data        :  data,
    dataType    : 'json'
})
    .done(function(res) {
     get()
    })
  })
  $('.view').on('click', function(event){
    let id;
    if(event.target.classList.contains('delete')){
      id = event.target.dataset.id
    }
    $.ajax({
    type        : 'DELETE',
    url         : `http://localhost:4000/loan/${id}`,
    dataType    : 'json'
})
    .done(function(res) {
     get()
    })
  })
  })
  </script>
</body>
</html>